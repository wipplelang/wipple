---
previous:
  name: Rendering HTML
  link: ?lesson=expert/html
next:
  name: Beyond the Playground
  link: ?lesson=expert/beyond-the-playground
---

---
id: wRflkmBe
type: text
locked: true
---

# Extending Wipple with JavaScript

Wipple's interactive features, like turtle graphics, are implemented in [JavaScript](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide). If you know some JavaScript, you can write your own interactive user interface (UI) and communicate with Wipple code!

The Wipple Playground offers a `with-ui` function that accepts a URL to a JavaScript file. This file must export an `initialize` function and an `onMessage` object, like so:

```javascript
export const onMessage = {};

export const initialize = async (id, container) => {
    onMessage[id] = messageHandler(container);
};

const messageHandler = (container) => (message, value) => {
    switch (message) {
        case "display-text":
            const p = document.createElement('p');
            p.textContent = value;
            container.appendChild(p);
            break;
        default:
            throw new Error("unhandled message");
    }
};
```

The above example is hosted on GitHub [here](https://raw.githubusercontent.com/wipplelang/playground-examples/main/ui-test.js), and you can import it into Wipple like so:

---
id: xsioQb6d
type: code
lint: false
---

url : "https://raw.githubusercontent.com/wipplelang/playground-examples/main/ui-test.js"

with-ui url (ui -> {
    -- TODO
})

---
id: 4uwD1vc2
type: text
locked: true
---

Now you can send messages to the UI element using `message`:

---
id: _ab7F-5R
type: code
---

url : "https://raw.githubusercontent.com/wipplelang/playground-examples/main/ui-test.js"

with-ui url (ui -> {
    ui . message "display-text" "Hello, world!"
})

---
id: wpL4U-V7
type: text
locked: true
---

It works! Now we can make a DSL around our custom interface:

---
id: wMm_w_kg
type: code
---

My-Interface : type {
    ui :: UI
}

[context]
my-interface :: My-Interface
my-interface : error "`my-interface` used outside `with-my-interface`"

with-my-interface : syntax {
    with-my-interface 'body -> {
        url : "https://raw.githubusercontent.com/wipplelang/playground-examples/main/ui-test.js"

        with-ui url (ui -> {
            with (my-interface : My-Interface { ui }) 'body
        })
    }
}

display-text :: Text -> ()
display-text : text -> ui of my-interface . message "display-text" text

with-my-interface {
    display-text "Hello, world!"
}

---
id: 5JwMwxXQ
type: text
locked: true
---

And let's host that on GitHub, too:

---
id: VseJ6oq7
type: code
---

use "https://raw.githubusercontent.com/wipplelang/playground-examples/main/my-interface.wpl"

with-my-interface {
    display-text "Hello, world!"
}

---
id: PuiML5sW
type: text
locked: true
---

You have access to the entire JavaScript API, and you can use [npm](https://npmjs.com) packages if you set up a bundler. For example, Wipple's built-in interfaces like `turtle` and `music` use [React](https://react.dev) and [Vite](https://vitejs.dev) configured in [library mode](https://vitejs.dev/guide/build.html#library-mode). Again, your imagination is the limit!
